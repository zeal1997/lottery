{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { createStore } from 'vuex';\nexport default createStore({\n  state: {\n    user: null,\n    prizes: [{\n      id: 1,\n      name: '360话费',\n      count: 5,\n      probability: 5\n    }, {\n      id: 2,\n      name: '咖啡券',\n      count: 100,\n      probability: 15\n    }, {\n      id: 3,\n      name: '充电宝',\n      count: 30,\n      probability: 10\n    }, {\n      id: 4,\n      name: '卡套插线板',\n      count: 50,\n      probability: 10\n    }, {\n      id: 5,\n      name: '网红小夜灯',\n      count: 50,\n      probability: 10\n    }, {\n      id: 6,\n      name: '小风扇',\n      count: 80,\n      probability: 15\n    }, {\n      id: 7,\n      name: '泡面碗',\n      count: 30,\n      probability: 10\n    }, {\n      id: 8,\n      name: '轻奢水杯',\n      count: 50,\n      probability: 10\n    }, {\n      id: 9,\n      name: '炫彩雨伞',\n      count: 50,\n      probability: 15\n    }, {\n      id: 10,\n      name: '谢谢参与',\n      count: 2500,\n      probability: 100\n    }],\n    hasDrawn: false,\n    winningPrize: null\n  },\n  mutations: {\n    setUser(state, user) {\n      state.user = user;\n    },\n    setHasDrawn(state, status) {\n      state.hasDrawn = status;\n    },\n    setWinningPrize(state, prize) {\n      state.winningPrize = prize;\n    },\n    decreasePrizeCount(state, prizeId) {\n      const prize = state.prizes.find(p => p.id === prizeId);\n      if (prize && prize.count > 0) prize.count--;\n    }\n  },\n  actions: {\n    // 登录验证 - 现在使用后端API\n    async login({\n      commit\n    }, {\n      phone,\n      password\n    }) {\n      try {\n        const response = await fetch('http://124.223.168.21:3001/api/login', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            phone,\n            password\n          })\n        });\n        const data = await response.json();\n        if (data.success) {\n          commit('setUser', data.user);\n          commit('setHasDrawn', data.user.hasDrawn);\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('登录错误:', error);\n        return false;\n      }\n    },\n    // 抽奖逻辑\n    async drawPrize({\n      state,\n      commit\n    }) {\n      if (state.hasDrawn) return null;\n\n      // 计算所有可用奖品（包括谢谢参与）\n      const availablePrizes = state.prizes.filter(p => p.count > 0);\n      if (availablePrizes.length === 0) return null;\n\n      // 计算总权重 - 改为基于count而非probability\n      const totalWeight = availablePrizes.reduce((sum, p) => sum + p.count, 0);\n      let winningPrize = null;\n      const random = Math.random() * totalWeight;\n      let cumulativeWeight = 0;\n\n      // 根据count权重选择奖品\n      for (const prize of availablePrizes) {\n        cumulativeWeight += prize.count; // 改为使用count作为权重\n        if (random <= cumulativeWeight) {\n          winningPrize = prize;\n          break;\n        }\n      }\n      if (winningPrize) {\n        // 只有非谢谢参与的奖品才减少数量\n        if (winningPrize.id !== 10) {\n          commit('decreasePrizeCount', winningPrize.id);\n        }\n        commit('setWinningPrize', winningPrize);\n        commit('setHasDrawn', true);\n\n        // 保存到数据库\n        try {\n          await fetch('http://124.223.168.21:3001/api/update-draw-result', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              phone: state.user.phone,\n              hasDrawn: true,\n              winningPrize: winningPrize.name\n            })\n          });\n        } catch (error) {\n          console.error('保存抽奖结果失败:', error);\n        }\n      }\n      return winningPrize;\n    }\n  }\n});","map":{"version":3,"names":["createStore","state","user","prizes","id","name","count","probability","hasDrawn","winningPrize","mutations","setUser","setHasDrawn","status","setWinningPrize","prize","decreasePrizeCount","prizeId","find","p","actions","login","commit","phone","password","response","fetch","method","headers","body","JSON","stringify","data","json","success","error","console","drawPrize","availablePrizes","filter","length","totalWeight","reduce","sum","random","Math","cumulativeWeight"],"sources":["/Users/jackie/Documents/vue/lottery/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\n\nexport default createStore({  \n  state: {\n    user: null,\n    prizes: [\n      { id: 1, name: '360话费', count: 5, probability: 5 },\n      { id: 2, name: '咖啡券', count: 100, probability: 15 },\n      { id: 3, name: '充电宝', count: 30, probability: 10 },\n      { id: 4, name: '卡套插线板', count: 50, probability: 10 }, \n      { id: 5, name: '网红小夜灯', count: 50, probability: 10 },\n      { id: 6, name: '小风扇', count: 80, probability: 15 },\n      { id: 7, name: '泡面碗', count: 30, probability: 10 },\n      { id: 8, name: '轻奢水杯', count: 50, probability: 10 },\n      { id: 9, name: '炫彩雨伞', count: 50, probability: 15 },\n      { id: 10, name:'谢谢参与',count: 2500 ,probability: 100 }\n    ],\n    hasDrawn: false,\n    winningPrize: null\n  },\n  mutations: {\n    setUser(state, user) { state.user = user },\n    setHasDrawn(state, status) { state.hasDrawn = status },\n    setWinningPrize(state, prize) { state.winningPrize = prize },\n    decreasePrizeCount(state, prizeId) {\n      const prize = state.prizes.find(p => p.id === prizeId)\n      if (prize && prize.count > 0) prize.count--\n    }\n  },\n  actions: {\n    // 登录验证 - 现在使用后端API\n    async login({ commit }, { phone, password }) {\n      try {\n        const response = await fetch('http://124.223.168.21:3001/api/login', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ phone, password })\n        })\n        \n        const data = await response.json()\n        \n        if (data.success) {\n          commit('setUser', data.user)\n          commit('setHasDrawn', data.user.hasDrawn)\n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('登录错误:', error)\n        return false\n      }\n    },\n    \n    // 抽奖逻辑\n    async drawPrize({ state, commit }) {\n      if (state.hasDrawn) return null\n    \n      // 计算所有可用奖品（包括谢谢参与）\n      const availablePrizes = state.prizes.filter(p => p.count > 0)\n      \n      if (availablePrizes.length === 0) return null\n      \n      // 计算总权重 - 改为基于count而非probability\n      const totalWeight = availablePrizes.reduce((sum, p) => sum + p.count, 0)\n      \n      let winningPrize = null\n      const random = Math.random() * totalWeight\n      let cumulativeWeight = 0\n      \n      // 根据count权重选择奖品\n      for (const prize of availablePrizes) {\n        cumulativeWeight += prize.count  // 改为使用count作为权重\n        if (random <= cumulativeWeight) {\n          winningPrize = prize\n          break\n        }\n      }\n    \n      if (winningPrize) {\n        // 只有非谢谢参与的奖品才减少数量\n        if (winningPrize.id !== 10) {\n          commit('decreasePrizeCount', winningPrize.id)\n        }\n        commit('setWinningPrize', winningPrize)\n        commit('setHasDrawn', true)\n        \n        // 保存到数据库\n        try {\n          await fetch('http://124.223.168.21:3001/api/update-draw-result', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              phone: state.user.phone,\n              hasDrawn: true,\n              winningPrize: winningPrize.name\n            })\n          })\n        } catch (error) {\n          console.error('保存抽奖结果失败:', error)\n        }\n      }\n      \n      return winningPrize\n    }\n  }\n})"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}